@using System.Security.Cryptography;
@using System.Text;
@using System.ComponentModel.DataAnnotations;
@using authstudio;

<h2>PKCE code generator</h2>
<div class="alert alert-secondary mt-4">
    <EditForm Model="PkceModel" OnSubmit="SubmitForm">
        <DataAnnotationsValidator />
        <div class="mb-3">
            <label for="CodeVerifier" class="form-label">Code Verifier</label>
            <InputText @bind-Value="PkceModel.CodeVerifier" class="form-control" disabled="true" />
        </div>
        <div class="mb-3">
            <label for="CodeChallenge" class="form-label">Code Challenge</label>
            <InputText @bind-Value="PkceModel.CodeChallenge" class="form-control" disabled="true" />
        </div>
        <div class="mb-3">
            <label for="CodeChallengeMethod" class="form-label">Challenge method</label>
            <span>@PkceModel.CodeChallengeMethod</span>
        </div>
        <button type="submit" class="btn btn-primary">Generate</button>
    </EditForm>
</div>

@code {
    [Parameter]
    public PkceChallengeModel PkceModel { get; set; } = new PkceChallengeModel();

    protected override void OnInitialized()
    {
        GenerateCodes();
        base.OnInitialized();
    }

    protected void SubmitForm()
    {
        GenerateCodes();
    }

    protected void GenerateCodes()
    {
        PkceModel.CodeVerifier = Pkce.GenerateVerifier(PkceModel.Length);
        PkceModel.CodeChallenge = Pkce.CreateChallenge(PkceModel.CodeVerifier);
        PkceModel.CodeChallengeMethod = "S256";
    }
}
